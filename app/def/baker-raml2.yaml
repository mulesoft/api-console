#%RAML 0.2
---
# More information at https://github.com/Simbul/baker/wiki/Baker-Server-API
title: Baker Server API
baseUri: http://localhost:3000/api
version: 1.0
documentation:
  - title: Getting Started
    content: |
      Certain features will only be available when supporting Baker with an external server.
      You will need a server to:

      * Host the shelf JSON file
      * Support auto-renewable subscriptions
      * Track In-App Purchases

      While the shelf JSON can be a static file that you periodically update by hand,
      to support subscriptions and track purchases your server will need to implement
      some more logic.

      Note that you will need to implement the server-side code yourself (or find an
      existing solution). This page lists the API calls that Baker will use to push
      and pull information from your server. This means that the server will have to
      offer the API, while Baker will use it.
traits:
  - appIdAware:
      name: Application ID Aware
      queryParameters:
        app_id:
          name: Application ID
          description: |
            The app_id is a unique identifier for your app (in case the server
            needs to manage more than one). By default, it is the same as the
            application's Bundle ID (e.g. com.example.MyBook).
          type: string
          required: true
  - userIdAware:
      name: User ID Aware
      queryParameters:
        user_id:
          name: User ID
          description: |
            A random value automatically generated by Baker, user_id will allow you to
            track a specific user. Note that, if a user removes and reinstalls the app,
            a new ID will be generated. This ensures that a user will be able to
            "log out" from a given ID.
          type: string
          required: true
  - environmentAware:
      name: Environment Aware
      queryParameters:
        environment:
          name: Environment
          description: |
            The _environment_ is a value that could be used by the endpoint to return
            different content for production and debugging/testing apps. The parameter
            will be set as follows:

            * _debug_ when the _DEBUG_ preprocessor directive is set to _1_
            * _production_ otherwise
          type: string
          enum: [ debug, production ]
        required: true
/issues:
  name: Shelf
  is: [ appIdAware, userIdAware, environmentAware ]
  post:
    summary: Create a new issue for Baker
    body:
      multipart/form-data:
        formParameters:
          name:
            name: Name
            description: 'A unique identifier for the issue. Note that both Newsstand and Baker rely on this ID, which should be unique and should never change. This property is used internally and it won''t be shown to the user.'
            type: string
            required: true
          title:
            name: Title
            description: 'The title of your issue. This is what users will see in the shelf. It should generally match the title specified in your book.json.'
            type: string
            required: true
          date:
            name: Publication Date
            description: 'The publication date for the issue, in the format YYYY-MM-DD HH:MM:SS. Note that issues in the shelf will be sorted according to the date (with the most recent ones on top). This property is used internally and it won''t be shown to the user.'
            type: string
            required: true
          cover:
            name: Cover File
            description: 'A cover for the selected issue. This is the cover that will be displayed in the shelf. The image should generally match the cover specified in your book.json (although note that the shelf cover will be stored on your server, while the book.json cover will be stored in the .hpub file). For best results on iPad, the cover size should be 270x360px.'
            type: file
            required: true
          hpub:
            name: HPub File
            description: 'An HPub file containing the issue. Baker will retrieve the issue every time a user decides to download it.'
            type: file
            required: true
          info:
            name: Info
            description: 'A short text that will be displayed below the title, in the shelf. It may be used to provide a summary of the content of an issue.'
            type: string
            required: false
          product_id:
            name: Product ID
            description: 'The product ID for a paid-for issue (from iTunes Connect).'
            type: string
            required: false
    responses:
      201:
        description: |
          The issue has been successfully created
        headers:
          Location:
            type: string
            description: Location of the newly created issue
      403:
        summary: Unauthorized
        description: |
          The user is not allowed to create issues
  get:
    summary: List all issues available to Baker
    responses:
      200:
        summary: OK
        description: this is a test
        body:
          application/json:
            schema: |
              {
                  "$schema": "http://json-schema.org/draft-03/schema",
                  "items": {
                      "name": "Issue",
                      "properties": {
                          "name": {
                              "description": "A unique identifier for the issue. Note that both Newsstand and Baker rely on this ID, which should be unique and should never change. This property is used internally and it won't be shown to the user.",
                              "type": "string"
                          },
                          "title": {
                              "description": "The title of your issue. This is what users will see in the shelf. It should generally match the title specified in your book.json.",
                              "type": "string"
                          },
                          "date": {
                              "description": "The publication date for the issue, in the format YYYY-MM-DD HH:MM:SS. Note that issues in the shelf will be sorted according to the date (with the most recent ones on top). This property is used internally and it won't be shown to the user.",
                              "type": "string"
                          },
                          "cover": {
                              "description": "The URL pointing to the cover for the selected issue. This is the cover that will be displayed in the shelf. The image should generally match the cover specified in your book.json (although note that the shelf cover will be stored on your server, while the book.json cover will be stored in the .hpub file). For best results on iPad, the cover size should be 270x360px.",
                              "type": "string"
                          },
                          "url": {
                              "description": "The URL pointing to the HPub file containing the issue. Baker will retrieve the issue from this URL every time a user decides to download it.",
                              "type": "string"
                          },
                          "info": {
                              "description": "A short text that will be displayed below the title, in the shelf. It may be used to provide a summary of the content of an issue.",
                              "type": "string",
                              "required": false
                          },
                          "product_id": {
                              "description": "The product ID for a paid-for issue (from iTunes Connect).",
                              "type": "string",
                              "required": false
                          },
                      },
                      "type": "object"
                  },
                  "name": "Issues",
                  "required": true,
                  "type": "array"
              }
            example: |
              [
                {
                  "name": "a-study-in-scarlet",
                  "title": "A Study in Scarlet",
                  "info": "The original masterpiece by Sir A. Conan Doyle",
                  "date": "1887-10-10 10:10:10",
                  "cover": "http://bakerframework.com/newsstand-books/a-study-in-scarlet.png",
                  "url": "http://bakerframework.com/newsstand-books/a-study-in-scarlet.hpub",
                  "product_id": "com.example.Baker.issues.january2013"
                },
                {
                  "name": "a-study-in-green",
                  "title": "A Study in Green",
                  "info": "An exciting remake of the original, with added mint!",
                  "date": "2010-10-10 10:10:10",
                  "cover": "http://bakerframework.com/newsstand-books/a-study-in-green.png",
                  "url": "http://bakerframework.com/newsstand-books/a-study-in-green.hpub"
                }

                ...

              ]